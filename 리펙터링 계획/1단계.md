
# 토스뱅크 클론 프로젝트 리팩터링 1단계 실행 계획

## 1단계: 프로젝트 구조 분석 및 준비 (1주)

### 1-1: 현재 코드베이스 분석 (3일)

#### 1일차: 의존성 관계 매핑
1. **모듈 의존성 그래프 생성**
   ```bash
   tuist graph --skip-external-dependencies # 그래프 생성
   ```
2. **각 모듈별 의존성 목록 작성**
   ```swift
   // 각 모듈의 Project.swift 파일에서 의존성 확인
   dependencies: [
       .project(target: "DomainModule", path: "../DomainModule"),
       .project(target: "NetworkModule", path: "../NetworkModule"),
       // ...
   ]
   ```
3. **순환 의존성 검사**
   - graph.png 파일 분석하여 순환 의존성 식별
   - 의존성 관계를 표 형태로 정리

#### 2일차: 코드 품질 및 기술 부채 평가
1. **정적 분석 도구 적용**
   ```bash
   swiftlint analyze --autocorrect # SwiftLint 실행
   ```
2. **코드 복잡도 측정**
   ```bash
   xcrun swift-metrics # Swift 코드 메트릭스 측정
   ```
3. **미사용 코드 식별**
   - 각 모듈별 Unused 코드 식별
   - 각 모듈별 크기 및 복잡도 측정

#### 3일차: 리팩터링 우선순위 결정
1. **문제점 목록 작성**
   - 각 모듈별 발견된 문제점 정리
   - 기술 부채 유형 분류 (아키텍처, 코드 품질, 테스트 부족 등)
2. **우선순위 매트릭스 작성**
   - 심각도(높음/중간/낮음)와 수정 난이도(높음/중간/낮음) 평가
   - 비즈니스 영향도 평가
3. **리팩터링 백로그 생성**
   - JIRA/GitHub Issues에 우선순위별 태스크 등록
   - 종속성 있는 작업 식별 및 선행 작업 표시

### 1-2: 리팩터링 환경 준비 (4일)

#### 4일차: 테스트 인프라 구축
1. **테스트 커버리지 측정 설정**
   ```swift
   // Tuist.swift 파일에 테스트 커버리지 설정 추가
   let settings = Settings.settings(
       base: [:],
       configurations: [
           .debug(name: "Debug", settings: [:], xcconfig: nil),
           .release(name: "Release", settings: [:], xcconfig: nil),
       ],
       defaultSettings: .recommended(excluding: [])
   )
   ```
2. **모의 객체 프레임워크 통합**
   ```swift
   // 각 테스트 타겟에 의존성 추가
   dependencies: [
       .external(name: "Mockingbird"),
       // ...
   ]
   ```
3. **테스트 데이터 생성기 구현**
   - 각 모듈별 테스트 데이터 팩토리 클래스 생성
   - 공통 테스트 유틸리티 작성

#### 5일차: CI/CD 파이프라인 보강
1. **지속적 통합 파이프라인 설정**
   ```yaml
   # GitHub Actions 워크플로우 파일 생성
   name: CI
   
   on:
     push:
       branches: [ main, develop ]
     pull_request:
       branches: [ main, develop ]
   
   jobs:
     build:
       runs-on: macos-latest
       steps:
       - uses: actions/checkout@v3
       - name: Set up Ruby
         uses: ruby/setup-ruby@v1
       - name: Install dependencies
         run: |
           gem install xcpretty
           brew install tuist
       - name: Run tests
         run: |
           tuist generate
           xcodebuild test -workspace TossBankClone.xcworkspace -scheme TossBankClone -destination 'platform=iOS Simulator,name=iPhone 14'
   ```
2. **브랜치 보호 규칙 설정**
   - GitHub 레포지토리 설정에서 브랜치 보호 규칙 구성
   - 코드 리뷰 필수화 및 CI 통과 필수화

#### 6-7일차: 코드 품질 측정 도구 설정
1. **코드 품질 측정 도구 통합**
   ```bash
   # SonarQube 또는 CodeClimate 설정
   brew install sonar-scanner
   sonar-scanner \
     -Dsonar.projectKey=TossBankClone \
     -Dsonar.sources=. \
     -Dsonar.host.url=http://localhost:9000 \
     -Dsonar.login=myauthtoken
   ```
2. **코딩 스타일 가이드 설정**
   ```
   # .swiftlint.yml 파일 생성/업데이트
   included:
     - App/
     - App/Modules/
   excluded:
     - Tuist/
     - Derived/
   ```
3. **자동화된 코드 리뷰 도구 설정**
   - GitHub Actions에 코드 리뷰 자동화 워크플로우 추가
   - 풀 리퀘스트 템플릿 작성

## 1단계 산출물 체크리스트

- [ ] 모듈 의존성 그래프 및 분석 문서
- [ ] 코드 품질 및 기술 부채 평가 보고서
- [ ] 우선순위가 지정된 리팩터링 백로그
- [ ] 테스트 인프라 설정 완료
- [ ] CI/CD 파이프라인 구성 완료
- [ ] 코드 품질 측정 도구 통합 완료
- [ ] 1단계 완료 보고서 및 2단계 세부 계획

이 1단계 실행 계획을 통해 리팩터링을 위한 기초를 탄탄하게 구축하고, 현재 코드베이스의 상태를 명확하게 파악하여 이후 단계에서의 효율적인 작업을 준비할 수 있습니다.
